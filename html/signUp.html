<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../style.css">
</head>
<div class="card" id="card">
    <form id="form">
        <h1 id="title">Sign Up</h1>
            <div id="log-in">

                <div id="email" class="input">
                    <h2>First name</h2>
                    <input type="text" id="fnameBox" placeholder="First Name" required>
                </div>

                <div id="pass" class="input">
                    <h2>Second Name</h2>
                    <input type="text" id="lnameBox" placeholder="Last Name" required>
                </div>

                <div id="email" class="input">
                    <h2>Email</h2>
                    <input type="email" id="emailBox" placeholder="Email" required>
                </div>

                <div id="pass" class="input">
                    <h2>Password</h2>
                    <input type="password" id="passBox" placeholder="Password" required>
                </div>

                <div id="role" class="input">
                    <input type="number" id="roleBox" value="0" style="display: none;">
                </div>
            <button type="submit" id="insBtn">Sign Up</button>
        <a href="./login.html" id="login">Log In</a>
    </form>
</div>
</body>
<script src="../js/signUp.js"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import {
      getDatabase,
      ref,
      set,
    } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    const firebaseConfig = {
      apiKey: "AIzaSyApxMylzZxo4C_p_OAoUuh5B5RnBrUpBCs",
      authDomain: "firedb1-4914e.firebaseapp.com",
      projectId: "firedb1-4914e",
      storageBucket: "firedb1-4914e.appspot.com",
      messagingSenderId: "274355745795",
      appId: "1:274355745795:web:7bd9613bd9dcdb8f918a36"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const auth = getAuth(app)

    //ref
    let fnameBox = document.getElementById("fnameBox");
    let lnameBox = document.getElementById("lnameBox");
    let passBox = document.getElementById("passBox");
    let emailBox = document.getElementById("emailBox");
    let roleBox = document.getElementById("roleBox");
    let form = document.getElementById("form");

    let RegisterUser = evt =>{
        evt.preventDefault();
        let userNo = 0
        createUserWithEmailAndPassword(auth, emailBox.value, passBox.value)
        .then((credentials)=>{
            console.log("User Created, Credentails: " + credentials);
            return set(ref(db, "userAuthList/" + credentials.user.uid), {
                firstname: fnameBox.value,
                lastname: lnameBox.value,
                email: emailBox.value,
                password: passBox.value,
                uid: credentials.user.uid,
                roleNo: roleBox.value
            })
        })

        .then(() => {
            alert("Successfully");
            location.href = "./login.html";
        })
        .catch((error) => {
            alert(error.message);
            console.log(error.code);
            console.log(error.message);
        })
    } 

    //assigns
    form.addEventListener("submit", RegisterUser);
  </script>
</html>